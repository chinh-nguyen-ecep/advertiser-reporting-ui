<html xmlns:xf="http://www.w3.org/2002/xforms">
   <head>
	<!-- do not include a <meta> tag -->
      <link rel="stylesheet" type="text/css" href="/pentaho-style/active/default.css"></link>
      <title>Ad-Responses By Devide Type</title>
            			
						<script src="js/parameters.js" type="text/javascript"></script>
						<script src="/verve_style/scripts/doform.js" type="text/javascript"></script>
						
						<script src="https://ajax.googleapis.com/ajax/libs/mootools/1.3.2/mootools-yui-compressed.js" type="text/javascript"></script>
						<script src="/verve_style/scripts/mootools-more.js" type="text/javascript"></script>
						<script src="/verve_style/scripts/verve-script.js" type="text/javascript"></script>

						<script src="/verve_style/scripts/Date.js" type="text/javascript"></script>
						<script src="/verve_style/scripts/datepicker/Locale.en-US.DatePicker.js" type="text/javascript"></script>
						<script src="/verve_style/scripts/datepicker/Picker.js" type="text/javascript"></script>
						<script src="/verve_style/scripts/datepicker/Picker.Attach.js" type="text/javascript"></script>
						<script src="/verve_style/scripts/datepicker/Picker.Date.js" type="text/javascript"></script>
					
						<link href="style.css" rel="stylesheet" />
						<link  href="/verve_style/scripts/datepicker/datepicker.css" rel="stylesheet" type="text/css" media="screen" />
						<link  href="/verve_style/css/tableInForm.css" rel="stylesheet" type="text/css" media="screen" />
						<link  href="/verve_style/css/meio.aucomplete.css" rel="stylesheet" type="text/css" media="screen" />
						
      			<script><![CDATA[
				var myPicker;
      			  function setDefaultValue() {
      			  	var obj = document.getElementById('v_max_date');
      			  	obj.selectedIndex = 1;
 
      			  	var curdate = document.getElementById('v_min_date');
      			  	curdate.selectedIndex = 1;		  	
      			  
      			  }
      			  //validation
				var validation=function(){
					var validate=true;
					
					//check select device
					var dimesion=$('dimesion').getElements('input:checked');
					if(dimesion.length==0){
					alert('Please select dimesion!');
					validate=false;
					}else if($$('input[name=p_measures]:checked').length>1&&dimesion.length>1){
						alert('Sorry! multi measures and multi dimension hasn\'t been developed');
						validate=false;	
					};
					
					//Compares start date and end date.
					var start_date_array=$('p_start_date').get('value').split("-");
					var end_date_array=$('p_end_date').get('value').split("-");
					var start_date=new Date();
					start_date.setFullYear(start_date_array[0],start_date_array[1]-1,start_date_array[2]);
					var end_date=new Date();
					end_date.setFullYear(end_date_array[0],end_date_array[1]-1,end_date_array[2]);
					
					if(start_date>end_date){
						alert('please choose start date < end date');
						validate=false;
					};
					//var count_date=start_date.diff(end_date);
					//if(count_date>7){
					//	alert('max is 7 days');
					//	validate=false;
					//}
					if(validate==true){
						doForm('a');
						myPicker.close();						
					};
					
				};	 
      			]]></script>
      		
	{xform-header}

   </head>
   <body>
   <div style="position: absolute;left: 10px;top: 10px;width: 65px;height: 65px;background-color: transparent;z-index: 1000;">
   <img style="cursor: pointer;" id="open" title="Open control panel" src="/verve_style/images/control_panel.png"/>
   
   </div>
      <div style="min-height: 380px;width: 100%" id="mydiv">
         <form name="parameter-form" id="parameter-form" method="GET">
         <table class="tableForm">
         <tbody>
	         <tr>
		         <th>Mode:</th>
		         <td><div style="float: left;">{p_date_mode}</div>
		         </td>
	         </tr>
	         <tr>
		         <th>Range from:</th>
		         <td><div id="datemode" style="float: left;">
		             <label style="margin-left: 0px;"></label> {p_start_date}
		             <label style="margin-left: 0px;">To:</label> {p_end_date}
		             </div>
		             <div id="monthmode" style="display: none;float: left;">
		             <label style="margin-left: 0px;"></label> {p_start_month}
		             <label style="margin-left: 0px;">To:</label> {p_end_month}
		             </div>
		        </td>
	         </tr>
	         <tr>
		         <th>Measures:</th>
		         <td>
				 <div style="width: 300px;border: 1px solid gray">
		          {p_measures} 
				 </div>
		         </td>
	         </tr>
	         <tr>
		         <th>Site:</th>
		         <td>		        
		         {p_Site}        
		         </td>
	         </tr>			
			 
	         <tr>
		         <th>Campaigns:</th>
		         <td>
					<input id="dimesion_fillter" type="text" style="width: 300px;"/>
					<div id="dimesion" style="width: 300px;border: 1px solid gray">
					{p_Campaign}
					</div>
		         </td>
	         </tr>
	          <tr>
		         <th>Chart type:</th>
		         <td>{chart_type}
				 <input type="button" style="cursor: pointer;margin-left:5px;" name="go" class="portlet-form-button" value="Run" onClick="validation()"/></td>
	         </tr>
	         
         </tbody>
         </table>
         	
             {v_max_date}{v_min_date}
             
             
			
		{solution}
		{action}
		{path}
	    </form>
		<!-- hiddent form -->
		
		
		<!-- end hiddent form -->
      </div>    
   
   <iframe width="100%" height="100%" name="theoutput" frameborder="0" scrolling="yes" style="overflow-x:hidden;"></iframe>
   
	<script>setDefaultValue();</script>
	<script> 
            window.addEvent('domready', function(){ 
				$('dimesion').getChildren('div')[0].setStyle('height',145)
            	//hide max_date and min_date
            	$('v_min_date').setStyle('display','none');
            	$('v_max_date').setStyle('display','none'); 
				//remove choose
				$$('option[value=]').each(function(item){
					//alert(item.get('value'));
					item.destroy();
					
				});
                //set default date
                
                $('p_end_date').setProperty('value',$('v_max_date').get('value'));
                
                var start_date_array=$('v_max_date').get('value').split("-");
                var mydate=new Date();
                mydate.setFullYear(start_date_array[0],start_date_array[1]-1,start_date_array[2]);
                mydate.decrement('day', 6);
                var todayCopy = mydate.clone().format('%Y-%m-%d');
                
                $('p_start_date').setProperty('value',todayCopy.toString());
                
                //create calendar
                
                new Picker.Date('p_start_date', {
				format: '%Y-%m-%d',
				minDate: $('v_min_date').get('value'),
				maxDate: $('v_max_date').get('value')				
				});
				new Picker.Date('p_end_date', {
				format: '%Y-%m-%d',
				minDate: $('v_min_date').get('value'),
				maxDate: $('v_max_date').get('value')				
				});
				
				//change mode
				$('p_date_mode_date').addEvent('click',function(){
					$('datemode').setStyle('display','');
					$('monthmode').setStyle('display','none');
				});
				$('p_date_mode_month').addEvent('click',function(){
					$('datemode').setStyle('display','none');
					$('monthmode').setStyle('display','');
				});
				
			
				
				//device_fillter
				var device_fillter=$('dimesion_fillter');
				
				device_fillter.addEvent('keyup', function(){
					var fillter_value=this.get('value').toLowerCase();					
					if(fillter_value != ""){
					//get all check box contant value fillter
					var list=$('dimesion').getElements('input:not(:checked)');
						list.each(function(item,index){
							var valueOfItem=item.get('value').toLowerCase();
							if(valueOfItem.indexOf(fillter_value)>-1){
								var tr=item.getParent('tr');								
								tr.setStyles({display: ''});
							}else{
								var tr=item.getParent('tr');								
								tr.setStyles({display: 'none'});
							};
					
						});
						
					}else{
					//get all check box contant value fillter
					var list=$('dimesion').getElements('input');						
						list.each(function(item,index){							
								var tr=item.getParent('tr');								
								tr.setStyles({display: ''});							
						});
					};
				});
				
				
				
				//picker
				var myElement=$('mydiv');
				myPicker = new Picker({
					pickerClass: 'datepicker1',					
					draggable: false,
					width: 500,
					height: 465,
					zindex: 1003					
				}).position(70, 17);
				
				myPicker.setContent(myElement,'fade');
				myPicker.setTitle('Control panel');
				myPicker.open();
				
				$('open').addEvent('click', function(e){
				e.stop();
				myPicker.open();
				});
				//get csv button
				$('getIframeContent').addEvent('click',function(event){
					event.stop();
					var text=$$('iframe[name=theoutput]')[0].contentDocument.getElement('table[id=datatable]').get('html');
					alert(text);
				});
            }); 
        </script>
   </body>
     
</html>