<div  id="sm_layout2" class="easyui-layout" style="" data-options="fit:true" >
        <div data-options="region:'south',split:true,title:'Data sources',collapsible:false" style="height:250px;padding:1px">
			<table id="sm_dataSources" data-options="singleSelect:true,fit:true,fitColumns:true,nowrap: false"></table>
		</div>
        <div  data-options="region:'west',split:true,title:'Customer',collapsible:false" style="width:250px;padding:0px">
			<table id="sm_customer" data-options="singleSelect:true,fit:true,fitColumns:true,nowrap: false"></table>
        </div>
        <div data-options="region:'center',title:'Subscriptions',collapsible:false" style="padding:1px">
			<table id="sm_subscriptions" data-options="singleSelect:true,fit:true,fitColumns:true,nowrap: false"></table>
        </div>
    </div>

<script>
//Set title of sub page
$('#manager_page_item_title').html('Subscription Manager');

//Load customer
var cutomersDataGrid=$('#sm_customer');
cutomersDataGrid.datagrid({
			url:rootPath+'&actions=listCustomers',
			columns:[[
				{field:'customer_key',title:'ID',resizable:false},
				{field:'customer_name',title:'Name',width:100}
				
			]],
			onSelect: function(rowIndex, rowData){
				subscriptionLoader(rowData.customer_key);
			}
		});
		
//function load subscriptions
var subscriptionLoader=function(customerID){
	var subDataGrid=$('#sm_subscriptions');
	subDataGrid.datagrid({
			url:rootSubPath+'&action=manager_page_subscription_manager.xaction&actions=listSubscriptionsByCustomerID&p_customer_key='+customerID,
			columns:[[
				{field:'ck',checkbox:true,resizable:false},
				{field:'subscription_key',title:'Key',resizable:false},
				{field:'subscription_name',title:'Name',width:200},
				{field:'subscription_status',title:'Status',align:'center',resizable:false},
				{field:'frequence',title:'Frequence',resizable:false},
				{field:'zip_before_transfer',title:'Zip',resizable:false},
				{field:'auto_public',title:'Auto public',resizable:false}
			]],
			onSelect: function(rowIndex, rowData){
				dataSourceLoader(rowData.subscription_key);
			}
		});
}

//add subscription button
console.log('sdfsdfsf');
$('#sm_layout2').layout();
var a=$('#sm_layout2').layout('panel','center');
a.panel({
	tools:[
		{
			iconCls:'icon-play',
			handler:function(){
				publicSubscriptions();
			}
		},
		{
			iconCls:'icon-add',
			handler:function(){alert('add')}
		},{
			iconCls:'icon-edit',
			handler:function(){alert('edit')}
		}
	]
});

//function public selected subacription
var publicSubscriptions=function(){
	var subDataGrid=$('#sm_subscriptions');
	var rowsSelected=subDataGrid.datagrid('getChecked');
	if(rowsSelected.length==0){
		$.messager.alert('Public subscription to customer','Please select a subscription!',function(r){
			if (r){
					alert('ok');
				}
			}
		);
	}else{		
		var subscriptionKey=rowsSelected[0].subscription_key;
		var subscriptionName=rowsSelected[0].subscription_name;
		var customerName=$('#sm_customer').datagrid('getSelected').customer_name;

            $.ajax({
                    url: rootSubPath+'&action=manager_page_subscription_manager.xaction&actions=publicSubscription&p_sub_key='+subscriptionKey,
                    dataType: 'json',
                    success: function(result){
                        var value=result[0].fn_spctl_insert_subscription_to_process;
						if(value>0){
							$.messager.show({
								title:'Public subscription',
								msg:'Publication process ID: '+value,
								timeout:5000,
								showType:'fade'			
							});		
						}else{
							$.messager.alert('Public subscription','Has another process has registed or run!');		
						}	
                    },
					error: function( jqXHR, textStatus, errorThrown ){
						$.messager.progress('close');
						$.messager.alert('Public subscription','Request error!');				
					},
					beforeSend: function(){						
						$.messager.progress({
							title: 'Public subscription',
							msg: 'Public subscription "'+subscriptionName+'" to "'+customerName+'"',
							interval: 150
						});						
					},
					complete: function(){
						$.messager.progress('close');
					}
                });		
		
	}
}
//function load data source
var dataSourceLoader=function(subKey){
	var dataSourceDataGrid=$('#sm_dataSources');
	dataSourceDataGrid.datagrid({
			url:rootSubPath+'&action=manager_page_subscription_manager.xaction&actions=listDataSourceBySubKey&p_sub_key='+subKey,
			columns:[[
				{field:'customer_article_key',title:'Article Key',resizable:false},
				{field:'df_config_id',title:'Data Source Key',resizable:false},
				{field:'df_config_name',title:'Name',width: 200},
				{field:'dt_desc',title:'Description'},	
				{field:'df_config_format',title:'Format',resizable:false},
				{field:'df_source_file',title:'Data source file'},
				{field:'table_name',title:'Data source table'},
				{field:'articel_status',title:'Article Status',resizable:false},
				{field:'df_status',title:'Data source status',resizable:false}
				
			]],
			onSelect: function(rowIndex, rowData){
				
			}
		});
}
</script>