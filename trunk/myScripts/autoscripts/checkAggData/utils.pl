use warnings;use DBI;use DBIx::AutoReconnect;use Date::Pcalc qw(:all);my $host="dw1";my $host2="dw3";my $dbname="warehouse";my $usename="autoscript";my $pwd="ECEP-2009";my $port="5432";sub getConnectionDw1{	my $conn='';	$conn=DBIx::AutoReconnect-> connect(           "dbi:PgPP:dbname=$dbname;host=$host;$port",           $usename,           $pwd,           {                PrintError => 0,                ReconnectTimeout => 60,                ReconnectFailure => sub { warn "oops!" },				ReconnectMaxTries => 100           },     );	return $conn;}sub getConnectionDw3{	my $conn='';	$conn=DBIx::AutoReconnect-> connect(           "dbi:PgPP:dbname=$dbname;host=$host2;$port",           $usename,           $pwd,           {                PrintError => 0,                ReconnectTimeout => 60,                ReconnectFailure => sub { warn "oops!" },				ReconnectMaxTries => 100           },     );	return $conn;}sub sendMail{my $mailaddress=shift;my $title=shift;my $content=shift;my $callFunction = "java -jar /home/song/autoscripts/bin/mail.jar \"$mailaddress\" \"$title\" \"$content\"";system($callFunction);}sub getTime{	my $result='';	my ($sec,$min,$hour,$day,$month,$yr19,@rest) =   localtime(time);	$month++;	$yr19+=1900;	$result="$yr19-$month-$day $hour:$min:$sec";	return $result;}sub yesterday{my $Dd=-1;my ($sec,$min,$hour,$day,$month,$yr19,@rest) =   localtime(time);$month++;$yr19+=1900;      my ($year1,$month1,$day1) = Add_Delta_Days($yr19,$month,$day,$Dd);	  if($day1<10){		$day1="0$day1";	  }	  if($month1<10){		$month1="0$month1";	  }	  my $datet= "$year1-$month1-$day1";	  return $datet;}sub yesterday2{my $Dd=-2;my ($sec,$min,$hour,$day,$month,$yr19,@rest) =   localtime(time);$month++;$yr19+=1900;      my ($year1,$month1,$day1) = Add_Delta_Days($yr19,$month,$day,$Dd);	  if($day1<10){		$day1="0$day1";	  }	  if($month1<10){		$month1="0$month1";	  }	  my $datet= "$year1-$month1-$day1";	  return $datet;}sub getReportName{	my $aggTableName=shift;	my %hash = (			'dw.daily_agg_ap_module_breakdown' => '- NetWorkTraffic.unknown' ,			'dw.daily_agg_group_act_all' => '- NetWorkTraffic.unknown' ,			'dw.daily_agg_group_portal_act_all' => '- NetWorkTraffic.unknown' ,			'dw.daily_agg_network_act_all' => '- NetWorkTraffic.unknown' ,			'dw.daily_agg_partner_act_all' => '- NetWorkTraffic.unknown' ,			'dw.daily_agg_partner_act_cont_mod_type' => '- NetWorkTraffic.unknown' ,			'dw.daily_agg_partner_act_content_category' => '- NetWorkTraffic.unknown' ,			'dw.daily_agg_partner_act_content_module' => '- NetWorkTraffic.unknown' ,			'dw.daily_agg_partner_act_date' => '- NetWorkTraffic.unknown' ,			'dw.daily_agg_partner_act_day_of_week' => '- NetWorkTraffic.unknown' ,			'dw.daily_agg_partner_act_device' => '- NetWorkTraffic.unknown' ,			'dw.daily_agg_partner_act_hour' => '- NetWorkTraffic.unknown' ,			'dw.daily_agg_partner_act_portal' => '- NetWorkTraffic.unknown' ,			'dw.daily_agg_portal_act_all' => '- NetWorkTraffic.unknown' ,			'dw.daily_agg_site_traffic' => '- NetWorkTraffic.unknown' ,			'dw.daily_agg_site_traffic_historical' => '- NetWorkTraffic.unknown' ,						'dbclk.daily_agg_adm_creative' => '- DBCLKReport.unknown',			'dbclk.daily_agg_adm_creative_delivery' => '- DBCLKReport.unknown',			'dbclk.daily_agg_campaign' => '- DBCLKReport.unknown',			'dbclk.daily_agg_publisher_device' => '- DBCLKReport.unknown',			'dbclk.daily_agg_publishers_day' => '- DBCLKReport.unknown',			'dbclk.daily_agg_site_campaign_day' => '- DBCLKReport.unknown',			'dbclk.daily_agg_site_day' => '- DBCLKReport.unknown',			'dbclk.daily_agg_site_order' => '- DBCLKReport.unknown',			'dbclk.daily_order_count_site' => '- DBCLKReport.unknown',						'adstraffic.daily_ad_serving_stats' => '- AdcelReport.unknown',			'adstraffic.daily_ad_serving_stats_by_content_category' => '- AdcelReport.unknown',			'adstraffic.daily_ad_serving_stats_by_device' => '- AdcelReport.unknown',			'adstraffic.daily_adcel_stats' => '- AdcelReport.unknown',			'adstraffic.daily_db_sellthrough_by_metro' => '- AdcelReport.unknown',			'adstraffic.daily_db_sellthrough_by_site' => '- AdcelReport.unknown',			'adstraffic.daily_location_stats_by_metro' => '- AdcelReport.unknown',			'adstraffic.daily_location_stats_by_region' => '- AdcelReport.unknown',						'adm.daily_agg_adm_data_feed' => '- ADM-DBCLKReport.',			'adm.daily_agg_order_atc' => '- Analysis.ADM-dbclk.daily_agg_order_atc',			'adm.daily_agg_order_placement_creative_flight' => '- Analysis.ADM-dbclk.daily_agg_order_placement_creative_flight',			'adm.daily_agg_publisher_website_partner' => '- Analysis.ADM-dbclk.daily_agg_publisher_website_partner',			'adm.daily_agg_revenue_by_order' => '- Adserving.Jasper.ADM-DBCLKDailyOrders\'RevenueReport<br/>- Adserving.InteractiveReport.OrderDetail',						'adnetwork.daily_mm_performance' => '- 3RDReport.Jasper.Daily Ad-network Performance',			'adnetwork.daily_jt_performance' => '- 3RDReport.Jasper.Daily Ad-network Performance',			'adnetwork.daily_ga_performance' => '- 3RDReport.Jasper.Daily Ad-network Performance',			'adnetwork.daily_wh_performance' => '- 3RDReport.Jasper.Daily Ad-network Performance',			'adnetwork.daily_mx_performance' => '- 3RDReport.Jasper.Daily Ad-network Performance',			'adnetwork.daily_adsense_dbclk_channel' => '- 3RDReport.Jasper.Daily Ad-network Performance',			'adnetwork.daily_cg_performance' => '- 3RDReport.Jasper.Daily Ad-network Performance',			'adnetwork.daily_it_performance' => '- 3RDReport.Jasper.Daily Ad-network Performance',			'adnetwork.daily_sp_performance' => '- 3RDReport.Jasper.Daily Ad-network Performance',			'adnetwork.daily_sp_blue_performance' => '- 3RDReport.Jasper.Daily Ad-network Performance',			'adnetwork.daily_yp_performance' => '- 3RDReport.Jasper.Daily Ad-network Performance',						'evttracker.daily_event_stats' => '- EventTracker.Jaspers.Daily Event Stats',			'evttracker.daily_event_stats_by_hour' => '- EventTracker.Charts.Event Tracker By FlightID',	);	my $result=$hash{$aggTableName};	return $result;}return 1;exit;