<html xmlns:xf="http://www.w3.org/2002/xforms">
   <head>
	<!-- do not include a <meta> tag -->
      <link rel="stylesheet" type="text/css" href="/pentaho-style/active/default.css"></link>
      <title id="exportFileName">Publisher Performance Report</title>
	  <link  href="/verve_style/css/tableInForm.css" rel="stylesheet" type="text/css" media="screen" />
	  <link  href="/verve_style/css/charttool.css" rel="stylesheet" type="text/css" media="screen" />
	  <link rel="stylesheet" type="text/css" href="/verve_style/scripts2/easyui/themes/metro/easyui.css" />
	  <link rel="stylesheet" type="text/css" href="/verve_style/scripts2/easyui/themes/icon.css" />
	  <link rel="stylesheet" type="text/css" href="/verve_style/scripts2/datetimepicker/jquery.datetimepicker.css" />
	  <link rel="stylesheet" type="text/css" href="/verve_style/scripts2/checkbox/jquery.checkbox.css" />
	  <link rel="stylesheet" type="text/css" href="/verve_style/scripts2/checkbox/jquery.safari-checkbox.css" />
	  <script src="/verve_style/scripts2/jquery.min.js"></script>	
	  <script src="/verve_style/scripts2/easyui/easyloader.js"></script>		
	  <script src="/verve_style/scripts2/easyui/jquery.easyui.min.js"></script>
	  <script src="/verve_style/scripts2/datetimepicker/jquery.datetimepicker.js"></script>
	  <script src="/verve_style/scripts2/checkbox/jquery.checkbox.min.js"></script>
	  <script src="/verve_style/scripts2/utils.js"></script>			  
      		
	{xform-header}
	<style>
		iframe{
			border: 1px dashed gray;
			padding: 0px;
			margin: 0px;			
		}
	</style>
   </head>
   <body style="background-color: #fff">

      <div class="easyui-dialog" title="Daily Verve Ads" data-options="iconCls:'icon-tip',modal:true" id="mydiv">
         <form name="parameter-form" id="parameter-form" method="GET">
         <table class="tableForm">
         <tbody>  
	         <tr >
		         <th>Range from:</th>
		         <td>
					<div id="datemode" style="float: left;">
						 <label style="margin-left: 0px;"></label> {p_start_date}
						 <div style="display:none">
						 <label style="margin-left: 0px;">To:</label> {p_end_date}
						 </div>
					</div>
		             <div id="monthmode" style="display: none;float: left;">
		             <label style="margin-left: 0px;"></label> {p_start_month_since_2005}
		             <label style="margin-left: 0px;">To:</label> {p_end_month_since_2005}
		             </div>	             
		        </td>
	         </tr>  
         </tbody>
         </table>
		          <div id="switch_control" >
			<table class="tableForm">
			 <tbody>		 

			</tbody>
		 </table>
		</div>
		<table class="tableForm">
         <tbody>
			<tr id="tr_bt">
				<th>Output type: </th>
				<td>
				{p_output}<input type="button" style="cursor: pointer;margin-left: 5px" name="go" class="portlet-form-button" value="Run" onClick="validation()"/>
				</td>
				 
	         </tr>
		 </tbody>
		 </table>
		 <div style="display: none">
        {v_max_date}
		{v_min_date} 
		{solution}
		{action}
		{path}		 
		 </div>
	    </form>
      </div>     
    <div class="easyui-tabs" data-options="fit: true" style="">
        <div title="Daily delivery" style="padding:10px">
            <iframe class="iframe" id="mainFrame1"   name="theoutput" frameborder="0" scrolling="yes" style="overflow-x:hidden;"></iframe>
        </div>
        <div title="Trends" style="padding:10px">
            <iframe class="iframe" id="mainFrame2"  name="theoutput1" frameborder="0" scrolling="yes" style="overflow-x:hidden;"></iframe>
        </div>        
    </div>
   
   
   
   <div id="toolbar2" style="margin-top: 40px;">	   
		   <div class="leftGroup">
		   <img id="open" title="Open control panel" src="/verve_style/images/preferences_system_windows_actions.png"/>		   
		   </div>	  
   </div>
	
	<script> 
	function changeSizeIframe(){
		var width=$(window).width();
		var height=$(window).height();
		$('.iframe').width(width-35);
		$('.iframe').height(height-55);
	}
	
	$( window ).resize(function() {
		var width=$(window).width();
		var height=$(window).height();
		console.log(width+'x'+height);
		changeSizeIframe();
	});
	$( document ).ready(function() {
		changeSizeIframe();
		console.log(  $().jquery );
		//Remove all Choose value of select 
		$('option[value=]').remove();
		$('#open').click(function(){
			$('#mydiv').dialog('open');
		});
		//Set location for dialog
		$('#mydiv').dialog({
			left: 70,
			top: 50,
			resizable:false
		});
		//Init date picker
		var start_date=new Date(new Date($('#v_max_date').val()).setDate(new Date($('#v_max_date').val()).getDate()-0));;
		var start_date=myformatter(start_date);
		$('input[name=p_start_date]').datetimepicker({
			value: start_date,
			timepicker:false,
			format: 'Y-m-d',
			validateOnBlur: false,
			formatDate:'Y-m-d',
			minDate: $('#v_min_date').val(),
			maxDate: $('#v_max_date').val()
		});
		$('input[name=p_end_date]').datetimepicker({
			value: $('#v_max_date').val(),
			timepicker:false,
			format: 'Y-m-d',
			formatDate:'Y-m-d',
			validateOnBlur: false,
			minDate: $('#v_min_date').val(),
			maxDate: $('#v_max_date').val()
		});		
		
	}); 
	function validation(){
		var start_date=$('#p_start_date').val();
		if(start_date==''){
			return false;
		}
		$('#mydiv').dialog('close');
		//Set data for Daily delivery
		var urlData={	
			p_date: '2015-01-28',
			p_report_type: 1			
		}
		urlData=$.extend({},$( "#parameter-form" ).serializeObject(),urlData); 
		var url='/pentaho/ViewAction?'+$.param(urlData);
		$('#mainFrame1').attr('src',url);
		
		//set data for Trends
		urlData.p_report_type=2;				
		var url='/pentaho/ViewAction?'+$.param(urlData);
		$('#mainFrame2').attr('src',url);	
		
		return true;
	}
    </script>
   </body>
     
</html>
