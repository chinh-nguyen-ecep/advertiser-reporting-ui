<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="daily_verve_delivery_trends_subreport1" language="groovy" pageWidth="880" pageHeight="572" orientation="Landscape" columnWidth="880" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="p_date_sk" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new Integer(1)]]></defaultValueExpression>
	</parameter>
	<parameter name="p_group_type" class="java.lang.String">
		<defaultValueExpression><![CDATA[new String("1day")]]></defaultValueExpression>
	</parameter>
	<parameter name="p_network_id" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new Integer(1)]]></defaultValueExpression>
	</parameter>
	<parameter name="SUBREPORT_DIR" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["/media/ecep2014/Setup/Ecep/Programs/Pentaho/biserver-ce-3.8.0-stable/biserver-ce/pentaho-solutions/verve_ads_ops/jaspers/daily_verve_delivery/"]]></defaultValueExpression>
	</parameter>
	<parameter name="p_sub_title" class="java.lang.String"/>
	<queryString>
		<![CDATA[SELECT
source_name
,impressions
,clicks
,revenue
,CASE WHEN impressions>0 THEN clicks::float/impressions ELSE 0 END AS ctr
,billable_rate as eCPM_paid
FROM adsops.daily_agg_verve_trends
WHERE is_active=true AND eastern_date_sk=$P{p_date_sk} AND group_type=$P{p_group_type} AND network_id=$P{p_network_id}]]>
	</queryString>
	<field name="source_name" class="java.lang.String"/>
	<field name="impressions" class="java.lang.Integer"/>
	<field name="clicks" class="java.lang.Integer"/>
	<field name="revenue" class="java.lang.Double"/>
	<field name="ctr" class="java.lang.Double"/>
	<field name="ecpm_paid" class="java.lang.Double"/>
	<variable name="impressions_1" class="java.lang.Integer" calculation="Sum">
		<variableExpression><![CDATA[$F{impressions}]]></variableExpression>
	</variable>
	<variable name="clicks_1" class="java.lang.Integer" calculation="Sum">
		<variableExpression><![CDATA[$F{clicks}]]></variableExpression>
	</variable>
	<variable name="revenue_1" class="java.lang.Double" calculation="Sum">
		<variableExpression><![CDATA[$F{revenue}]]></variableExpression>
	</variable>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="20">
			<staticText>
				<reportElement mode="Opaque" x="180" y="0" width="130" height="20" forecolor="#FEFEFE" backcolor="#28C3E7"/>
				<box topPadding="2" leftPadding="5" rightPadding="5"/>
				<textElement textAlignment="Right">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<text><![CDATA[Impressions]]></text>
			</staticText>
			<textField>
				<reportElement mode="Opaque" x="0" y="0" width="180" height="20" forecolor="#FEFEFE" backcolor="#28C3E7"/>
				<box topPadding="2" leftPadding="5" rightPadding="5"/>
				<textElement textAlignment="Left" verticalAlignment="Top" rotation="None" lineSpacing="Single" markup="none">
					<font fontName="Arial" size="10" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$P{p_sub_title}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement mode="Opaque" x="430" y="0" width="150" height="20" forecolor="#FEFEFE" backcolor="#28C3E7"/>
				<box topPadding="2" leftPadding="5" rightPadding="5"/>
				<textElement textAlignment="Right">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<text><![CDATA[CTR]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="580" y="0" width="150" height="20" forecolor="#FEFEFE" backcolor="#28C3E7"/>
				<box topPadding="2" leftPadding="5" rightPadding="5"/>
				<textElement textAlignment="Right">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<text><![CDATA[Revenue]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="310" y="0" width="120" height="20" forecolor="#FEFEFE" backcolor="#28C3E7"/>
				<box topPadding="2" leftPadding="5" rightPadding="5"/>
				<textElement textAlignment="Right">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<text><![CDATA[Clicks]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="730" y="0" width="150" height="20" forecolor="#FEFEFE" backcolor="#28C3E7"/>
				<box topPadding="2" leftPadding="5" rightPadding="5"/>
				<textElement textAlignment="Right">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<text><![CDATA[eCPM Paid]]></text>
			</staticText>
		</band>
	</title>
	<detail>
		<band height="20">
			<textField>
				<reportElement x="0" y="0" width="180" height="20"/>
				<box topPadding="2" leftPadding="5" rightPadding="5"/>
				<textElement>
					<font fontName="Arial"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{source_name}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0">
				<reportElement x="180" y="0" width="130" height="20"/>
				<box topPadding="2" leftPadding="5" rightPadding="5"/>
				<textElement textAlignment="Right">
					<font fontName="Arial"/>
				</textElement>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$F{impressions}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0">
				<reportElement x="310" y="0" width="120" height="20"/>
				<box topPadding="2" leftPadding="5" rightPadding="5"/>
				<textElement textAlignment="Right">
					<font fontName="Arial"/>
				</textElement>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$F{clicks}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00%" isBlankWhenNull="false">
				<reportElement mode="Transparent" x="430" y="0" width="150" height="20" forecolor="#000000" backcolor="#FFFFFF"/>
				<box topPadding="2" leftPadding="5" rightPadding="5"/>
				<textElement textAlignment="Right" verticalAlignment="Top" rotation="None" lineSpacing="Single" markup="none">
					<font fontName="Arial" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
				</textElement>
				<textFieldExpression class="java.lang.Double"><![CDATA[$F{ctr}]]></textFieldExpression>
			</textField>
			<textField pattern="$ #,##0" isBlankWhenNull="false">
				<reportElement mode="Transparent" x="580" y="0" width="150" height="20" forecolor="#000000" backcolor="#FFFFFF"/>
				<box topPadding="2" leftPadding="5" rightPadding="5"/>
				<textElement textAlignment="Right" verticalAlignment="Top" rotation="None" lineSpacing="Single" markup="none">
					<font fontName="Arial" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
				</textElement>
				<textFieldExpression class="java.lang.Double"><![CDATA[$F{revenue}]]></textFieldExpression>
			</textField>
			<textField pattern="$ #,##0.00">
				<reportElement x="730" y="0" width="150" height="20"/>
				<box topPadding="2" leftPadding="5" rightPadding="5"/>
				<textElement textAlignment="Right">
					<font fontName="Arial"/>
				</textElement>
				<textFieldExpression class="java.lang.Double"><![CDATA[$F{ecpm_paid}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<summary>
		<band height="20">
			<textField pattern="#,##0">
				<reportElement x="180" y="0" width="130" height="20"/>
				<box topPadding="2" leftPadding="5" rightPadding="5">
					<topPen lineWidth="0.5"/>
					<bottomPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Right">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$V{impressions_1}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0">
				<reportElement x="310" y="0" width="120" height="20"/>
				<box topPadding="2" leftPadding="5" rightPadding="5">
					<topPen lineWidth="0.5"/>
					<bottomPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Right">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$V{clicks_1}]]></textFieldExpression>
			</textField>
			<textField pattern="$ #,##0">
				<reportElement x="580" y="0" width="150" height="20"/>
				<box topPadding="2" leftPadding="5" rightPadding="5">
					<topPen lineWidth="0.5"/>
					<bottomPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Right">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.Double"><![CDATA[$V{revenue_1}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00%">
				<reportElement x="430" y="0" width="150" height="20"/>
				<box topPadding="2" leftPadding="5" rightPadding="5">
					<topPen lineWidth="0.5"/>
					<bottomPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Right">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.Double"><![CDATA[( $V{impressions_1}>0 ? $V{clicks_1}.doubleValue()/$V{impressions_1} : 0 )]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="0" y="0" width="180" height="20"/>
				<box topPadding="2" leftPadding="5" rightPadding="5">
					<topPen lineWidth="0.5"/>
					<bottomPen lineWidth="1.0"/>
				</box>
				<textElement>
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<text><![CDATA[Grand Total]]></text>
			</staticText>
			<textField pattern="$ #,##0.00" isBlankWhenNull="true">
				<reportElement x="730" y="0" width="150" height="20"/>
				<box topPadding="2" leftPadding="5" rightPadding="5">
					<topPen lineWidth="0.5"/>
					<bottomPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Right">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.Double"><![CDATA[( $V{impressions_1}==0 ? 0 : $V{revenue_1}.doubleValue()*1000/$V{impressions_1} )]]></textFieldExpression>
			</textField>
		</band>
	</summary>
</jasperReport>
