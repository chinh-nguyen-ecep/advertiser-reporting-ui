<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="daily_vlmo by offer" pageWidth="1190" pageHeight="842" orientation="Landscape" columnWidth="1150" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20">
	<property name="ireport.zoom" value="1.0000000000000004"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<style name="boder">
		<box>
			<pen lineWidth="0.5"/>
			<topPen lineWidth="0.5"/>
			<leftPen lineWidth="0.5"/>
			<bottomPen lineWidth="0.5"/>
			<rightPen lineWidth="0.5"/>
		</box>
	</style>
	<parameter name="p_start_month_since_2005" class="java.lang.String">
		<defaultValueExpression><![CDATA[new String("0")]]></defaultValueExpression>
	</parameter>
	<parameter name="SUBREPORT_DIR" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA[""]]></defaultValueExpression>
	</parameter>
	<parameter name="p_end_month_since_2005" class="java.lang.String">
		<defaultValueExpression><![CDATA[new String("0")]]></defaultValueExpression>
	</parameter>
	<parameter name="p_agency_id" class="java.lang.String">
		<defaultValueExpression><![CDATA[new String("0")]]></defaultValueExpression>
	</parameter>
	<parameter name="p_merchant_ids" class="java.lang.String">
		<defaultValueExpression><![CDATA[new String("0")]]></defaultValueExpression>
	</parameter>
	<parameter name="p_offer_ids" class="java.lang.String">
		<defaultValueExpression><![CDATA[new String("0")]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT
(max(dt_lastchange)::timestamp with time zone AT TIME ZONE 'America/Los_Angeles')::timestamp with time zone AT TIME ZONE 'America/New_York'as dt_lastchange,
calendar_year_month as "Month",
network_id as "Agency ID",
network_title as "Agency Name",
publisher_id as "Publisher ID",
merchant_id as "Merchant ID",
merchant_name as "Merchant Name",
external_id as "External ID",
offer_id as "Offer ID",
offer_title as "Offer Title",
SUM(impressions) as "Impressions",
SUM(clicks) as "Clicks"
FROM vlmo_dw.daily_agg_demand_by_offer
WHERE is_active = true
AND month_since_2005 BETWEEN $P{p_start_month_since_2005}::int AND $P{p_end_month_since_2005}::int
AND network_id=$P{p_agency_id}
AND (merchant_id IN(select unnest(string_to_array($P{p_merchant_ids}, ','))::int) OR '0'=$P{p_merchant_ids})
AND (offer_id IN(select unnest(string_to_array($P{p_offer_ids}, ','))::int) OR '0'=$P{p_offer_ids})
GROUP BY
calendar_year_month,
month_since_2005,
network_id,
network_title,
publisher_id,
merchant_id,
merchant_name,
external_id,
offer_id,
offer_title
ORDER BY
month_since_2005,
network_id,
publisher_id,
merchant_id,
offer_id]]>
	</queryString>
	<field name="dt_lastchange" class="java.sql.Timestamp"/>
	<field name="Month" class="java.lang.String"/>
	<field name="Agency ID" class="java.lang.String"/>
	<field name="Agency Name" class="java.lang.String"/>
	<field name="Publisher ID" class="java.lang.Integer"/>
	<field name="Merchant ID" class="java.lang.Integer"/>
	<field name="Merchant Name" class="java.lang.String"/>
	<field name="External ID" class="java.lang.String"/>
	<field name="Offer ID" class="java.lang.Integer"/>
	<field name="Offer Title" class="java.lang.String"/>
	<field name="Impressions" class="java.lang.Long"/>
	<field name="Clicks" class="java.lang.Long"/>
	<variable name="Impressions_1" class="java.lang.Long" calculation="Sum">
		<variableExpression><![CDATA[$F{Impressions}]]></variableExpression>
	</variable>
	<variable name="Clicks_1" class="java.lang.Long" calculation="Sum">
		<variableExpression><![CDATA[$F{Clicks}]]></variableExpression>
	</variable>
	<background>
		<band/>
	</background>
	<columnHeader>
		<band height="20">
			<staticText>
				<reportElement style="boder" x="115" y="0" width="75" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Agency ID]]></text>
			</staticText>
			<staticText>
				<reportElement style="boder" x="190" y="0" width="107" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Agency Name]]></text>
			</staticText>
			<staticText>
				<reportElement style="boder" x="297" y="0" width="87" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Publisher ID]]></text>
			</staticText>
			<staticText>
				<reportElement style="boder" x="384" y="0" width="78" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Merchant ID]]></text>
			</staticText>
			<staticText>
				<reportElement style="boder" x="462" y="0" width="180" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Merchant Name]]></text>
			</staticText>
			<staticText>
				<reportElement style="boder" x="725" y="0" width="67" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Offer ID]]></text>
			</staticText>
			<staticText>
				<reportElement style="boder" x="792" y="0" width="188" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Offer Title]]></text>
			</staticText>
			<staticText>
				<reportElement style="boder" x="980" y="0" width="85" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement textAlignment="Right">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Impressions]]></text>
			</staticText>
			<staticText>
				<reportElement style="boder" x="1065" y="0" width="85" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement textAlignment="Right">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Clicks]]></text>
			</staticText>
			<staticText>
				<reportElement style="boder" x="642" y="0" width="83" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[External ID]]></text>
			</staticText>
			<staticText>
				<reportElement style="boder" x="0" y="0" width="115" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Month]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="20">
			<textField>
				<reportElement style="boder" x="115" y="0" width="75" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement/>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{Agency ID}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement style="boder" x="190" y="0" width="107" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement/>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{Agency Name}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement style="boder" x="297" y="0" width="87" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement/>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$F{Publisher ID}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement style="boder" x="384" y="0" width="78" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement/>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$F{Merchant ID}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement style="boder" x="462" y="0" width="180" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement/>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{Merchant Name}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement style="boder" x="725" y="0" width="67" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement/>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$F{Offer ID}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement style="boder" x="792" y="0" width="188" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement/>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{Offer Title}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0">
				<reportElement style="boder" x="980" y="0" width="85" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement textAlignment="Right"/>
				<textFieldExpression class="java.lang.Long"><![CDATA[$F{Impressions}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0">
				<reportElement style="boder" x="1065" y="0" width="85" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement textAlignment="Right"/>
				<textFieldExpression class="java.lang.Long"><![CDATA[$F{Clicks}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement style="boder" x="642" y="0" width="83" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement/>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{External ID}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement style="boder" x="0" y="0" width="115" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement/>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{Month}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<summary>
		<band height="20">
			<textField pattern="#,##0">
				<reportElement style="boder" x="980" y="0" width="85" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement textAlignment="Right">
					<font isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.Long"><![CDATA[$V{Impressions_1}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0">
				<reportElement style="boder" x="1065" y="0" width="85" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement textAlignment="Right">
					<font isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.Long"><![CDATA[$V{Clicks_1}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement style="boder" x="792" y="0" width="188" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Total]]></text>
			</staticText>
			<staticText>
				<reportElement style="boder" x="462" y="0" width="180" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Total]]></text>
			</staticText>
			<staticText>
				<reportElement style="boder" x="725" y="0" width="67" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Total]]></text>
			</staticText>
			<staticText>
				<reportElement style="boder" x="384" y="0" width="78" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Total]]></text>
			</staticText>
			<staticText>
				<reportElement style="boder" x="297" y="0" width="87" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Total]]></text>
			</staticText>
			<staticText>
				<reportElement style="boder" x="190" y="0" width="107" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Total]]></text>
			</staticText>
			<staticText>
				<reportElement style="boder" x="115" y="0" width="75" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Total]]></text>
			</staticText>
			<staticText>
				<reportElement style="boder" x="0" y="0" width="115" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Total]]></text>
			</staticText>
			<staticText>
				<reportElement style="boder" x="642" y="0" width="83" height="20"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Total]]></text>
			</staticText>
		</band>
	</summary>
</jasperReport>
