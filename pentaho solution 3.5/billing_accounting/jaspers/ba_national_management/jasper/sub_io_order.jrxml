<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="detail_at_io_line_item_level" language="groovy" pageWidth="1670" pageHeight="842" orientation="Landscape" columnWidth="1670" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="calendar_year_month" class="java.lang.String">
		<defaultValueExpression><![CDATA[new String("")]]></defaultValueExpression>
	</parameter>
	<parameter name="p_io_orders" class="java.lang.String">
		<defaultValueExpression><![CDATA[new String("0")]]></defaultValueExpression>
	</parameter>
	<parameter name="p_io_line_items" class="java.lang.String">
		<defaultValueExpression><![CDATA[new String("0")]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[select a.calendar_year_month as "Month"
, a.month_since_2005
, a.advertiser_io as "IO Number"
, a.io_orders_id
, a.updated_at::date as io_revision_date
, a.organization_name as "Advertiser"
, a.contract_name as "Campaign Name"
, a.agency_name as "Agency"
, SUM(a.delivered_units) as "Delivered Units"
, SUM(ROUND(a.invoice_amount::NUMERIC, 2)) as "Invoiced Amount"
, SUM(ROUND(a.total_amount_invoiced_upto_month::NUMERIC, 2)) as "Invoiced to Month"
from  billing.ba_monthly_national_worksheet a
left join billing.ba_national_dim_io b ON (b.is_active = true AND b.io_orders_id = a.io_orders_id AND b.io_line_item_id = a.io_line_item_id)
where calendar_year_month = $P{calendar_year_month}::text
and (a.io_orders_id IN (select unnest(string_to_array($P{p_io_orders}, ','))::int) OR '0'=$P{p_io_orders}::text)
and (a.io_line_item_id IN (select unnest(string_to_array($P{p_io_line_items}, ','))::int) OR '0'=$P{p_io_line_items}::text)
and a.is_active = true
group by a.calendar_year_month
, a.month_since_2005
, a.advertiser_io
, a.io_orders_id
, a.updated_at::date
, a.organization_name
, a.contract_name
, a.agency_name
order by "Advertiser";]]>
	</queryString>
	<field name="Month" class="java.lang.String"/>
	<field name="month_since_2005" class="java.lang.Integer"/>
	<field name="IO Number" class="java.lang.String"/>
	<field name="io_orders_id" class="java.lang.Integer"/>
	<field name="io_revision_date" class="java.sql.Date"/>
	<field name="Advertiser" class="java.lang.String"/>
	<field name="Campaign Name" class="java.lang.String"/>
	<field name="Agency" class="java.lang.String"/>
	<field name="Delivered Units" class="java.math.BigDecimal"/>
	<field name="Invoiced Amount" class="java.math.BigDecimal"/>
	<field name="Invoiced to Month" class="java.math.BigDecimal"/>
	<variable name="Invoiced Amount_1" class="java.lang.Double" calculation="Sum">
		<variableExpression><![CDATA[$F{Invoiced Amount}]]></variableExpression>
	</variable>
	<variable name="Invoiced to Month_1" class="java.lang.Double" calculation="Sum">
		<variableExpression><![CDATA[$F{Invoiced to Month}]]></variableExpression>
	</variable>
	<columnHeader>
		<band height="50" splitType="Stretch">
			<staticText>
				<reportElement mode="Opaque" x="0" y="20" width="80" height="30" backcolor="#FFFF00"/>
				<box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Month]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="80" y="20" width="200" height="30" backcolor="#FFFF00"/>
				<box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[IO Number]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="280" y="20" width="240" height="30" backcolor="#FFFF00"/>
				<box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Advertiser]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="520" y="20" width="400" height="30" backcolor="#FFFF00"/>
				<box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Campaign Name]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="920" y="20" width="400" height="30" backcolor="#FFFF00"/>
				<box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Agency]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="1320" y="20" width="150" height="30" backcolor="#FFFF00"/>
				<box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Delivered
Units]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="1470" y="20" width="100" height="30" backcolor="#FFFF00"/>
				<box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Invoiced
Amount]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="1570" y="20" width="100" height="30" backcolor="#FFFF00"/>
				<box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Invoiced
to Month]]></text>
			</staticText>
			<staticText>
				<reportElement x="0" y="0" width="520" height="20" forecolor="#FF0000"/>
				<box leftPadding="5" rightPadding="5"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial" size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[2. The summary at the IO Order level]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="20" splitType="Stretch">
			<textField>
				<reportElement x="0" y="0" width="80" height="20"/>
				<box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement/>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{Month}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="80" y="0" width="200" height="20"/>
				<box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement/>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{IO Number}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="280" y="0" width="240" height="20"/>
				<box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement/>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{Advertiser}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="520" y="0" width="400" height="20"/>
				<box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement/>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{Campaign Name}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="920" y="0" width="400" height="20"/>
				<box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement/>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{Agency}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0">
				<reportElement x="1320" y="0" width="150" height="20"/>
				<box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Right"/>
				<textFieldExpression class="java.lang.Long"><![CDATA[$F{Delivered Units}]]></textFieldExpression>
			</textField>
			<textField pattern="$ #,##0.00">
				<reportElement x="1470" y="0" width="100" height="20"/>
				<box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Right"/>
				<textFieldExpression class="java.lang.Double"><![CDATA[$F{Invoiced Amount}]]></textFieldExpression>
			</textField>
			<textField pattern="$ #,##0.00">
				<reportElement x="1570" y="0" width="100" height="20"/>
				<box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Right"/>
				<textFieldExpression class="java.lang.Double"><![CDATA[$F{Invoiced to Month}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<summary>
		<band height="40">
			<staticText>
				<reportElement x="0" y="0" width="80" height="20"/>
				<box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Total]]></text>
			</staticText>
			<staticText>
				<reportElement x="80" y="0" width="200" height="20"/>
				<box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Total]]></text>
			</staticText>
			<staticText>
				<reportElement x="280" y="0" width="240" height="20"/>
				<box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Total]]></text>
			</staticText>
			<staticText>
				<reportElement x="520" y="0" width="400" height="20"/>
				<box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Total]]></text>
			</staticText>
			<staticText>
				<reportElement x="920" y="0" width="400" height="20"/>
				<box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Total]]></text>
			</staticText>
			<staticText>
				<reportElement x="1320" y="0" width="150" height="20"/>
				<box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Total]]></text>
			</staticText>
			<textField pattern="$ #,##0.00">
				<reportElement x="1570" y="0" width="100" height="20"/>
				<box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Right">
					<font isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.Double"><![CDATA[$V{Invoiced to Month_1}]]></textFieldExpression>
			</textField>
			<textField pattern="$ #,##0.00">
				<reportElement x="1470" y="0" width="100" height="20"/>
				<box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Right">
					<font isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.Double"><![CDATA[$V{Invoiced Amount_1}]]></textFieldExpression>
			</textField>
		</band>
	</summary>
</jasperReport>
